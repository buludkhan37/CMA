<div class="custom-select-container">
    @if (label()) {
        <label class="select-label" [class.required]="required()" [for]="selectId">
            {{ label() }}
            @if (required()) {
                <span class="required-indicator">*</span>
            }
        </label>
    }
    <div
        class="select-wrapper"
        [class.focused]="isFocused()"
        [class.error]="hasError()"
        [class.disabled]="isDisabled()"
        [class.open]="isOpen()"
    >
        <div
            role="combobox"
            class="select-field"
            [id]="selectId"
            [tabindex]="isDisabled() ? -1 : 0"
            [attr.aria-expanded]="isOpen()"
            [attr.aria-haspopup]="'listbox'"
            [attr.aria-disabled]="isDisabled()"
            (click)="toggleDropdown()"
            (keydown)="onKeyDown($event)"
            (blur)="closeDropdown()"
        >
            <span class="selected-text" [class.placeholder]="!getSelectedLabel()">
                {{ getSelectedLabel() || placeholder() }}
            </span>

            <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                class="dropdown-arrow"
            >
                <polyline points="6,9 12,15 18,9"></polyline>
            </svg>
        </div>

        @if (isOpen()) {
            <div class="dropdown-menu">
                @for (option of options(); track option.value) {
                    <div
                        class="dropdown-option"
                        [class.selected]="option.value === value()"
                        [class.disabled]="option.disabled"
                        [attr.role]="'option'"
                        [attr.aria-selected]="option.value === value()"
                        (mousedown)="selectOption(option)"
                    >
                        {{ option.label }}
                        @if (option.value === value()) {
                            <svg
                                width="16"
                                height="16"
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                                class="check-icon"
                            >
                                <polyline points="20,6 9,17 4,12"></polyline>
                            </svg>
                        }
                    </div>
                }
                @if (options().length === 0) {
                    <div class="no-options">Нет доступных опций</div>
                }
            </div>
        }
    </div>

    <div class="select-footer">
        @if (hasError()) {
            <div class="error-message">
                <svg
                    width="14"
                    height="14"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                >
                    <circle cx="12" cy="12" r="10" />
                    <line x1="15" y1="9" x2="9" y2="15" />
                    <line x1="9" y1="9" x2="15" y2="15" />
                </svg>
                {{ errorMessage() }}
            </div>
        }
        @if (helpText() && !hasError()) {
            <div class="help-text">
                {{ helpText() }}
            </div>
        }
    </div>
</div>
